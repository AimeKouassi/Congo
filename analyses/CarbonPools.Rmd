---
title: "Carbon Pools Congo"
author: "Lattifa Fofana, Aimé Kouassi, Eric Forni, Sylvie Gourlet-Fleury & Bruno Hérault"
date: "6/6/2018"
output: 
  github_document:
    toc: true
    toc_depth: 3
    df_print: paged
---

# Research Questions
*What is the magnitude of carbon pools in deadwood and small stems as compared to standard AGB (>10 DBH) ?*

*Are there some ecologically-sound relationships between the 3 pools?*

*What is the level of environmental control on pools and relationships?*

# Dead Biomass

```{r DB upload 1, include=FALSE}
c93<-read.csv2("c93.csv",header = TRUE)
c94<-read.csv2("c94.csv",header = TRUE)
c95<-read.csv2("c95.csv",header = TRUE)
c113<-read.csv2("c113.csv",header = TRUE)
c114<-read.csv2("c114.csv",header = TRUE)
c115<-read.csv2("c115.csv",header = TRUE)
c123<-read.csv2("c123.csv",header = TRUE)
c124<-read.csv2("c124.csv",header = TRUE)
c125<-read.csv2("c125.csv",header = TRUE)
c133<-read.csv2("c133.csv",header = TRUE)
c134<-read.csv2("c134.csv",header = TRUE)
c135<-read.csv2("c135.csv",header = TRUE)
c143<-read.csv2("c143.csv",header = TRUE)
c144<-read.csv2("c144.csv",header = TRUE)
c145<-read.csv2("c145.csv",header = TRUE)
c163<-read.csv2("c163.csv",header = TRUE)
c164<-read.csv2("c164.csv",header = TRUE)
c165<-read.csv2("c165.csv",header = TRUE)
c177<-read.csv2("c177.csv",header = TRUE)
c178<-read.csv2("c178.csv",header = TRUE)
c179<-read.csv2("c179.csv",header = TRUE)
c197<-read.csv2("c197.csv",header = TRUE)
c198<-read.csv2("c198.csv",header = TRUE)
c199<-read.csv2("c199.csv",header = TRUE)
c217<-read.csv2("c217.csv",header = TRUE)
c218<-read.csv2("c218.csv",header = TRUE)
c219<-read.csv2("c219.csv",header = TRUE)
c284<-read.csv2("c284.csv",header = TRUE)
c285<-read.csv2("c285.csv",header = TRUE)
c286<-read.csv2("c286.csv",header = TRUE)
c304<-read.csv2("c304.csv",header = TRUE)
c305<-read.csv2("c305.csv",header = TRUE)
c306<-read.csv2("c306.csv",header = TRUE)
c324<-read.csv2("c324.csv",header = TRUE)
c325<-read.csv2("c325.csv",header = TRUE)
c326<-read.csv2("c326.csv",header = TRUE)
lwd<-rbind(c93, c94, c95, c113, c114, c115, c123, c124, c125, c133, c134, c135, 
           c143, c144, c145, c163, c164, c165, c177, c178, c179, c197, c198, c199, c217, 
           c218, c219, c284, c285, c286, c304, c305, c306, c324, c325, c326) # lwd's data combinations = lwd
# rename / arrange some column's name on lwd's data
colnames(lwd)[1]<-"n"
colnames(lwd)[2]<-"x"
colnames(lwd)[13]<-"subplot"
lwd$plot<-as.character(lwd$plot)
lwd[lwd$plot=="1 Ouest",]$plot<-"1W"
lwd[lwd$plot=="2 Ouest",]$plot<-"2W"
lwd[lwd$plot=="1 Est",]$plot<-"1E"
lwd[lwd$plot=="2 Est",]$plot<-"2E"
lwd$treeID<-paste(lwd$n, lwd$plot, lwd$square, lwd$transect, sep = "_") # creation of treelwdID
# convert to julian date for the new lwd1's data
library(date)
lwd$dateJ<-julian(strptime(lwd$date, "%d/%m/%Y"))
# replace 0's by NA's on lwd$Dh
lwd$Dh[lwd$Dh == 0]= NA
# replace 0's by NA's on lwd$Circumf
lwd$circumf[lwd$circumf == 0]= NA
# calculation of geometric mean diameters Dg               		
lwd$Dg=exp(rowMeans(log(data.frame(lwd$Dh,lwd$Dv)), na.rm=TRUE)) 
```

```{r DB upload 2, include=FALSE}
d93<-read.csv2("d93.csv",header = TRUE)
d94<-read.csv2("d94.csv",header = TRUE)
d95<-read.csv2("d95.csv",header = TRUE)
d113<-read.csv2("d113.csv",header = TRUE)
d114<-read.csv2("d114.csv",header = TRUE)
d115<-read.csv2("d115.csv",header = TRUE)
d123<-read.csv2("d123.csv",header = TRUE)
d124<-read.csv2("d124.csv",header = TRUE)
d125<-read.csv2("d125.csv",header = TRUE)
d133<-read.csv2("d133.csv",header = TRUE)
d134<-read.csv2("d134.csv",header = TRUE)
d135<-read.csv2("d135.csv",header = TRUE)
d143<-read.csv2("d143.csv",header = TRUE)
d144<-read.csv2("d144.csv",header = TRUE)
d145<-read.csv2("d145.csv",header = TRUE)
d163<-read.csv2("d163.csv",header = TRUE)
d164<-read.csv2("d164.csv",header = TRUE)
d165<-read.csv2("d165.csv",header = TRUE)
d177<-read.csv2("d177.csv",header = TRUE)
d178<-read.csv2("d178.csv",header = TRUE)
d179<-read.csv2("d179.csv",header = TRUE)
d197<-read.csv2("d197.csv",header = TRUE)
d198<-read.csv2("d198.csv",header = TRUE)
d199<-read.csv2("d199.csv",header = TRUE)
d217<-read.csv2("d217.csv",header = TRUE)
d218<-read.csv2("d218.csv",header = TRUE)
d219<-read.csv2("d219.csv",header = TRUE)
d284<-read.csv2("d284.csv",header = TRUE)
d285<-read.csv2("d285.csv",header = TRUE)
d286<-read.csv2("d286.csv",header = TRUE)
d304<-read.csv2("d304.csv",header = TRUE)
d305<-read.csv2("d305.csv",header = TRUE)
d306<-read.csv2("d306.csv",header = TRUE)
d324<-read.csv2("d324.csv",header = TRUE)
d325<-read.csv2("d325.csv",header = TRUE)
d326<-read.csv2("d326.csv",header = TRUE)
swd<-rbind(d93, d94, d95, d113, d114, d115, d123, d124, d125, d133, d134, d135, 
           d143, d144, d145, d163, d164, d165, d177, d178, d179, d197, d198, d199, d217, 
           d218, d219, d284, d285, d286, d304, d305, d306, d324, d325, d326)  # swd's data combinations = swd
# omit value's adding on swd
swd$CIRCdbh[45]= 34
swd$CIRCdbh[291]= 82
swd$CIRCdbh[339]= 33
# rename / arrange some column's name on swd's data
colnames(swd)[1]<-"n"
colnames(swd)[2]<-"x"
colnames(swd)[3]<-"y"
colnames(swd)[4]<-"DBH"
colnames(swd)[5]<-"Dlow"
colnames(swd)[6]<-"Dhigh"
# calculate diameter
swd$DBH=swd$DBH/pi
swd$Dlow=swd$Dlow/pi
swd$Dhigh=swd$Dhigh/pi
colnames(swd)[13]<-"subplot"
swd$plot<-as.character(swd$plot)
swd[swd$plot=="1 Ouest",]$plot<-"1W"
swd[swd$plot=="2 Ouest",]$plot<-"2W"
swd[swd$plot=="1 Est",]$plot<-"1E"
swd[swd$plot=="2 Est",]$plot<-"2E"
# creation of treelwdID
swd$treeID<-paste(swd$n, swd$plot, swd$square, swd$transect, sep = "_") # creation of treelwdID
# convert to julian date for the new lwd1's data
library(date)
swd$dateJ<-julian(strptime(swd$date, "%d/%m/%Y"))
# replace 0's by NA's on swd
swd$DBH[swd$DBH == 0]= NA
swd$Dlow[swd$Dlow == 0]= NA
swd$Dhigh[swd$Dhigh == 0]= NA
# db's and dt's calculation 
# db
library(dplyr)
DBH = c(swd$DBH)
Dlow = c(swd$Dlow)
test1=tibble(DBH, Dlow )
swd$db<-data.frame(test1 %>% transmute(DBH = ifelse(is.na(DBH), Dlow, DBH)))[,1] 
# dt 
dtDBH=c(1.59*swd$DBH*swd$H^{-0.091})
dtDhigh=c(swd$Dhigh) 
test2=tibble(dtDBH, dtDhigh)
swd$dt<-data.frame(test2 %>% transmute(dtDBH = ifelse(is.na(dtDBH), dtDhigh, dtDBH)))[,1] 
```

## Descriptive Statistics

### Lying Deadwood

#### Density
```{r D density, include=TRUE, echo=FALSE}
library(knitr)
LWD_subplot<-data.frame(subplot=names(table(lwd$subplot)), N=as.numeric(table(lwd$subplot)))
LWD_subplot<-merge(LWD_subplot, unique(data.frame(plot=lwd$plot, subplot=lwd$subplot)), 
                  by.x="subplot", by.y="subplot")
LWD_subplot$N<-(LWD_subplot$N/(4*111.7))*100 # LWD mean values/subplot/100 m

library(ggplot2)
library(devtools)
ggplot(LWD_subplot, aes(N)) + geom_density(aes(fill=factor(plot)), alpha=0.5) + 
  labs(title="Lying deadwood Density Plot", 
       subtitle="Observed Number of lying deadwood per 100m walking, grouped per plot",
       caption="Source: DynAfFor",
       x="Lying deadwood (per 100m walking)",
       fill="# Plot Names")

```

#### DBH

```{r DBH distribution, include=TRUE, echo=FALSE}
library(ggplot2)
ggplot(lwd, aes(x = Dg, fill = plot)) +
  geom_histogram(binwidth = 10, alpha = 1, position = "dodge")+
  labs(title="Diameter Distribution", 
       subtitle="Observed Absolute Frequencies grouped per plot",
       caption="Source: DynAfFor",
       x="Diameter (cm)",
       y="Absolute Frequencies",
       fill="# Plot Names")
```


#### Length
```{r Length distribution, include=TRUE, echo=FALSE}
library(ggplot2)
ggplot(lwd, aes(x = L, fill = plot)) +
  geom_histogram(binwidth = 3, alpha = 1, position = "dodge")+
  labs(title="Length Distribution", 
       subtitle="Observed Absolute Frequencies grouped per plot",
       caption="Source: DynAfFor",
       x="Length (m)",
       y="Absolute Frequencies",
       fill="# Plot Names")
```
       

### Standing Deadwood
#### Density

```{r standing density, include=TRUE, echo=FALSE}
library(knitr)
SWD_subplot<-data.frame(subplot=names(table(swd$subplot)), N=as.numeric(table(swd$subplot)))
SWD_subplot<-merge(SWD_subplot, unique(data.frame(plot=swd$plot, subplot=swd$subplot)), 
                   by.x="subplot", by.y="subplot")
Sp= 111.7*20*4-4*20^2
SWD_subplot$N<-SWD_subplot$N/Sp*10000
library(ggplot2)
library(devtools)
ggplot(SWD_subplot, aes(N)) + geom_density(aes(fill=factor(plot)), alpha=0.5) + 
  labs(title="Standing Deadwood Density", 
       subtitle="Observed Number of standing deadwood per hectare, grouped per plot",
       caption="Source: DynAfFor",
       x="Number of standing deadwood (per ha)",
       fill="# Plot Names")
```

#### DBH
```{r standing DBH, include=TRUE, echo=FALSE}
library(ggplot2)
ggplot(swd, aes(x = db, fill = plot)) +
  geom_histogram(binwidth = 10, alpha = 1, position = "dodge")+
  labs(title="Base diameter (db) Distribution", 
       subtitle="Observed Absolute Frequencies grouped per plot",
       caption="Source: DynAfFor",
       x="Base diameter (cm)",
       y="Absolute Frequencies",
       fill="# Plot Names")
```


#### Height
```{r standing Height, include=TRUE, echo=FALSE}
library(ggplot2)
ggplot(swd, aes(x = H, fill = plot)) +
  geom_density(aes(fill=factor(plot)), alpha=0.5)+
  labs(title="Height Distribution", 
       subtitle="Density curves, grouped per plot",
       caption="Source: DynAfFor",
       x="Height (m)",
       fill="# Plot Names")

```
## Estimating Carbon Pool Values

## Estimating Carbon Pool Variabilities

# Small Stems

```{r SS upload, include=FALSE}
tig1=read.csv2("ti1.csv")
tig2=read.csv2("ti2.csv")
tig3=read.csv2("ti3.csv")
tig4=read.csv2("ti4.csv")
tig5=read.csv2("ti5.csv")
tig5$X<-NULL
tig6=read.csv2("ti6.csv")
tig7=read.csv2("ti7.csv")
tig8=read.csv2("ti8.csv")
tig9=read.csv2("ti9.csv")
tig10=read.csv2("ti10.csv")
tig11=read.csv2("ti11.csv")
tig12=read.csv2("ti12.csv")
tig13=read.csv2("ti13.csv")
tig14=read.csv2("ti14.csv")
tig15=read.csv2("ti15.csv")
tig16=read.csv2("ti16.csv")
tig17=read.csv2("ti17.csv")
tig18=read.csv2("ti18.csv")
tig19=read.csv2("ti19.csv")
tig20=read.csv2("ti20.csv")
tig21=read.csv2("ti21.csv")
tig22=read.csv2("ti22.csv")
tig23=read.csv2("ti23.csv")
tig24=read.csv2("ti24.csv")
tig25=read.csv2("ti25.csv")
tig26=read.csv2("ti26.csv")
tig27=read.csv2("ti27.csv")
tig28=read.csv2("ti28.csv")
tig29=read.csv2("ti29.csv")
tig30=read.csv2("ti30.csv")
tig31=read.csv2("ti31.csv")
tig32=read.csv2("ti32.csv")
tig33=read.csv2("ti33.csv")
tig34=read.csv2("ti34.csv")
tig35=read.csv2("ti35.csv")
tig36=read.csv2("ti36.csv")
tig37=read.csv2("ti37.csv")
tig38=read.csv2("ti38.csv")
tig39=read.csv2("ti39.csv")
tig40=read.csv2("ti40.csv")
tig41=read.csv2("ti41.csv")
tig42=read.csv2("ti42.csv")
tig43=read.csv2("ti43.csv")
tig44=read.csv2("ti44.csv")
tig45=read.csv2("ti45.csv")
tig46=read.csv2("ti46.csv")
tig47=read.csv2("ti47.csv")
tig48=read.csv2("ti48.csv")
colnames(tig10)[9]="DBH"
tabx<-rbind(tig1,tig2, tig3, tig4,tig5,tig6,tig7,tig8,tig9,tig10,tig11,tig12,tig13,tig14,tig15,tig16,tig17,tig18,tig19,tig20,tig21,tig22,tig23,tig24,tig25,tig26,tig27,tig28,tig29,tig30,tig31,tig32,tig33,tig34,tig35,tig36,tig37,tig38,tig39,tig40,tig41,tig42,tig43,tig44,tig45,tig46,tig47,tig48)
colnames(tabx)[2]="plot"
colnames(tabx)[3]="subplot"
colnames(tabx)[4]="n"
colnames(tabx)[5]="vernacularname"
colnames(tabx)[2]="plot"
colnames(tabx)[6]="g"
colnames(tabx)[7]="sp"
colnames(tabx)[8]="h"
colnames(tabx)[10]="quadrat"
tabx$treeID<-paste(tabx$plot, tabx$subplot, tabx$quadrat, tabx$n, sep = "_")
tabx$dateJ<-julian(strptime(tabx$DATE, "%d/%m/%Y"))
tabx$plot<-as.character(tabx$plot)
tabx[tabx$plot=="1 ouest",]$plot<-"1W"
tabx[tabx$plot=="2 ouest",]$plot<-"2W"
tabx[tabx$plot=="2 OUEST",]$plot<-"2W"
tabx[tabx$plot=="2 Est",]$plot<-"2E"
tabx[tabx$plot=="2 EST",]$plot<-"2E"
tabx[tabx$plot=="1 EST",]$plot<-"1E"
tabx[tabx$plot=="1 OUEST",]$plot<-"1W"
tabx[tabx$plot=="1 OESUT",]$plot<-"1W"
```

## Descriptive Statistics

### Stem Density

```{r DS_SS, include=TRUE, echo=FALSE}
library(knitr)
SS_quadrat<-data.frame(subplot=names(table(tabx$subplot)), N=as.numeric(table(tabx$subplot)))
SS_quadrat[SS_quadrat$subplot %in% c(114, 144, 198, 305),]$N<-SS_quadrat[SS_quadrat$subplot %in% c(114, 144, 198, 305),]$N/4
SS_quadrat<-merge(SS_quadrat, unique(data.frame(plot=tabx$plot, subplot=tabx$subplot)), by.x="subplot", by.y="subplot")
SS_quadrat$N<-SS_quadrat$N/400*10000
library(ggplot2)
library(devtools)
g <- ggplot(SS_quadrat, aes(N))
g + geom_density(aes(fill=factor(plot)), alpha=0.5) + 
    labs(title="Small Stem Density Plot", 
         subtitle="Observed Absolute Frequencies grouped per plot",
         caption="Source: DynAfFor",
         x="N Small Stems (per ha)",
         fill="# Plot Names")
```

### DBH Distribution

```{r DBH_SS, include=TRUE, echo=FALSE}
library(ggplot2)
ggplot(tabx, aes(x = DBH, fill = plot)) +
        geom_histogram(binwidth = 0.5, alpha = 1, position = "dodge")+
      labs(title="DBH Distribution", 
         subtitle="Observed Absolute Frequencies grouped per plot",
         caption="Source: DynAfFor",
         x="DBH (cm)",
         y="Absolute Frequencies",
         fill="# Plot Names")
```


### Height Distribution

```{r HEIGHT_SS, include=TRUE, echo=FALSE}
library(ggplot2)
ggplot(tabx, aes(x = h, fill = plot)) +
        geom_histogram(binwidth = 0.5, alpha = 1, position = "dodge")+
      labs(title="Height Distribution", 
         subtitle="Observed Absolute Frequencies grouped per plot",
         caption="Source: DynAfFor",
         x="Height (m)",
         y="Absolute Frequencies",
         fill="# Plot Names")
```

### Basic Correlations
 
## Estimating Carbon Pool Values

## Estimating Carbon Pool Variabilities

# AboveGround Biomass

## Basic Checks

## Results from BIOMASS package

```{r lound data, include=TRUE, echo=FALSE}
library(ggplot2)
loun <- read.csv("~/Library/Mobile Documents/com~apple~CloudDocs/Bruno/Publications/Congo/Congo/analyses/Loun.csv")
loun$bloc_parcelle<-as.character(loun$bloc_parcelle)
loun[loun$bloc_parcelle=="bloc est/parcelle 1",]$bloc_parcelle<-"1E"
loun[loun$bloc_parcelle=="bloc est/parcelle 2",]$bloc_parcelle<-"2E"
loun[loun$bloc_parcelle=="bloc ouest/parcelle 1",]$bloc_parcelle<-"1W"
loun[loun$bloc_parcelle=="bloc ouest/parcelle 2",]$bloc_parcelle<-"2W"
library(BIOMASS)
```


# Linking the 3 carbon pools together


